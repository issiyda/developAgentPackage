# Creating Agents - Claude Code SubAgent作成支援

このagentは、Claude CodeのsubAgent（サブエージェント）を作成するための包括的な知識とガイダンスを提供します。

## 概要

`creating-agents` agentを使用することで、エージェントは以下のことができるようになります：

- ✅ Claude Code subAgentの正しい構造を理解する
- ✅ 効果的なメタデータ（name、description、tools、model）を定義する
- ✅ 高品質なシステムプロンプトを設計する
- ✅ ベストプラクティスに従った実装を行う
- ✅ 適切なテストと検証を実施する
- ✅ 実践的な例から学ぶ

## ファイル構成

```
creating-agents/
├── README.md              # このファイル
└── ../creating-agents.md  # メインのagent定義と包括的なガイド
```

## 使い方

### 自動起動

このagentは、以下のようなリクエストで自動的に起動します：

```
「新しいsubAgentを作成したい」
「コードレビュー用のエージェントを作りたい」
「エージェントの作り方を教えて」
「subAgentのベストプラクティスは?」
```

キーワード: agent作成、カスタムエージェント、sub-agent開発、サブエージェント実装

### 手動での参照

特定の情報が必要な場合は、直接ファイルを参照できます：

```bash
# メインガイドを読む
cat .claude/agents/creating-agents.md
```

## 提供される知識

### 1. SubAgentの基礎知識
- SubAgentとは何か
- 主な利点（コンテキスト保持、専門性向上、権限分離、再利用性）
- ファイル構造と保存場所
- ファイル形式（YAMLフロントマター）

### 2. メタデータフィールド詳細
- **name**: 命名規則とベストプラクティス
- **description**: 効果的な説明の書き方（最重要フィールド）
- **tools**: ツールアクセスの制御と選択ガイドライン
- **model**: モデル選択（sonnet/opus/haiku/inherit）
- **color**: 視覚的識別のための色指定

### 3. システムプロンプトの設計
- 基本構造（役割、専門知識、タスク、手順、ベストプラクティス、出力フォーマット）
- プロンプト設計のベストプラクティス
  - 明確な役割定義
  - 具体的な手順の提示
  - 期待される出力形式の定義
  - コンテキストとベストプラクティスの埋め込み

### 4. 実装例
以下の4つの完全な実装例：
1. **コードレビュアー**: git変更のコード品質チェック
2. **セキュリティアナライザー**: OWASP Top 10に基づくセキュリティレビュー
3. **テスト実行者**: テスト実行、失敗分析、修正
4. **ドキュメント生成者**: README、API仕様書、コメント生成

### 5. ベストプラクティス
- 単一責任の原則
- "Solve, don't punt" の原則
- コンテキストの効率的利用
- エラーハンドリング戦略
- フィードバックループの確立
- モデルの適切な選択
- 段階的な詳細化
- テストとイテレーション

### 6. トラブルシューティング
よくある問題と解決方法：
- エージェントが呼び出されない
- エージェントの出力が一貫性がない
- コンテキスト制限に達する
- エージェントが遅い

### 7. 高度なテクニック
- マルチエージェント連携
- 動的なツール選択
- コンテキスト管理戦略
- エージェントのバージョン管理

## 学べる主要トピック

### descriptionフィールドの最適化

最も重要なフィールドです。Claude Codeがこのエージェントを呼び出すかどうかを判断する主要な情報源になります。

**含めるべき内容**:
1. 使用タイミング
2. 具体的なタスク
3. キーワード（技術用語やドメイン用語）
4. 使用例（3つ以上推奨）
5. 積極的呼び出しのフレーズ（"PROACTIVELY"、"MUST BE USED"など）

### ツール選択ガイドライン

| エージェントタイプ | 推奨ツール | 理由 |
|-----------------|-----------|------|
| コードレビュアー | Read, Grep, Glob, Bash | 読み取り専用、幅広い検索 |
| デバッガー | Read, Edit, Grep, Glob, Bash | 修正も可能 |
| データ分析者 | Bash, Read, Write | 実行とレポート作成 |
| リサーチャー | WebFetch, WebSearch, Read, Write | Web情報収集 |
| テスト実行者 | Bash, Read, Write, Grep | テスト実行とレポート |

### モデル選択のガイドライン

| タスクの複雑さ | 推奨モデル | 特徴 |
|-------------|-----------|------|
| 単純な検索や情報収集 | haiku | 高速、低コスト |
| 標準的なコーディング | sonnet | バランスが良い（推奨デフォルト） |
| 複雑な分析や設計 | opus | 最高品質、高コスト |
| メインセッションに依存 | inherit | 一貫性重視 |

## 使用例

### 例1: 新しいsubAgentのアイデアから始める

```
ユーザー: "データベースマイグレーションを管理するsubAgentを作りたい"

エージェント: [creating-agents agentが起動]
1. 要件を整理（何をするエージェントか）
2. 適切なメタデータを提案
   - name: db-migration-manager
   - tools: Bash, Read, Write, Grep
   - model: sonnet
3. システムプロンプトの構造を設計
4. 実装例を提供
5. テストシナリオを提案
```

### 例2: 既存agentの改善

```
ユーザー: "既存のコードレビューagentを改善したい"

エージェント: [creating-agents agentが起動]
1. 現在のagent定義を読む
2. ベストプラクティスと照らし合わせる
3. 改善点を特定
   - descriptionの詳細化
   - 出力フォーマットの明確化
   - エラーハンドリングの追加
4. 具体的な改善策を提案
```

### 例3: チーム向けagentの作成

```
ユーザー: "チームで使うPRレビューワークフローのagentを作りたい"

エージェント: [creating-agents agentが起動]
1. ワークフローの要件を確認
2. マルチエージェント連携パターンを提案
   - code-reviewer呼び出し
   - security-analyzer呼び出し
   - test-runner呼び出し
3. オーケストレーターagentの実装
4. チーム向けドキュメント作成
```

## チェックリスト

このagentを使って新しいsubAgentを作成する際は、以下を確認してください：

### メタデータ
- [ ] `name`は分かりやすく一意
- [ ] `description`は具体的で詳細（200語以上推奨）
- [ ] 積極的呼び出しのフレーズを含む
- [ ] キーワードを豊富に含む
- [ ] 使用例を3つ以上含む
- [ ] `tools`は必要最小限に制限
- [ ] `model`は適切に選択
- [ ] `color`で視覚的に識別可能

### プロンプト品質
- [ ] 役割が明確に定義されている
- [ ] 具体的な手順が記載されている
- [ ] 期待される出力フォーマットが定義されている
- [ ] エラーハンドリング戦略が含まれている
- [ ] ベストプラクティスが明記されている
- [ ] 500-1000行程度に収まっている

### 機能性
- [ ] 基本シナリオでテスト済み
- [ ] エッジケースでテスト済み
- [ ] エラー状態でテスト済み
- [ ] 複数のモデル（haiku/sonnet/opus）でテスト済み
- [ ] パフォーマンスが許容範囲

### ドキュメンテーション
- [ ] 使用方法が明確
- [ ] 制限事項が記載されている
- [ ] トラブルシューティングガイドがある
- [ ] チーム向けのドキュメントがある

## SubAgent作成の流れ

1. **目的の明確化** - 何を自動化したいか
2. **設計** - メタデータとプロンプトの構造化
3. **実装** - ファイル作成とプロンプト記述
4. **テスト** - 様々なシナリオで動作確認
5. **最適化** - フィードバックに基づく改善
6. **デプロイ** - チームでの共有と活用

## トラブルシューティング

### Agentが起動しない
- descriptionにキーワードが含まれているか確認
- 積極的呼び出しのフレーズ（"PROACTIVELY"など）を追加
- 使用例を具体的に記載

### 出力が一貫性がない
- 出力フォーマットを明確に定義
- 期待される構造をマークダウンコードブロックで示す
- 「厳密に守ってください」などの強い指示を追加

### コンテキスト制限に達する
- プロンプトを簡潔に（500-1000行を目安）
- 詳細情報は外部ファイルに分離
- 段階的な情報収集戦略を採用

### パフォーマンスが遅い
- 並列処理を活用
- 適切なツールを選択（Grep > Bash grep）
- 不要なファイルアクセスを削減

## 重要な原則

1. **専門性**: 各エージェントは特定のドメインに特化
2. **自律性**: "Solve, don't punt" - 問題を自ら解決
3. **効率性**: コンテキストは貴重なリソース
4. **品質**: 一貫性のある高品質な出力
5. **反復改善**: 継続的なフィードバックと改善

## 参考リンク

公式ドキュメント:
- [Claude Code サブエージェント公式ドキュメント](https://code.claude.com/docs/ja/sub-agents)
- [Claude Code でカスタムサブエージェントを作成する](https://azukiazusa.dev/blog/create-custom-sub-agent-in-claude-code/)

## バージョン情報

- 作成日: 2025-11-29
- ベース情報: Claude Code公式ドキュメント + 複数の実践的記事
- バージョン: 1.0.0

## ライセンス

このagentはプロジェクト内で自由に使用・改変できます。
